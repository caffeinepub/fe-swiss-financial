{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 47,
  "summary": "Build a CRM application for a Swiss financial advisory firm (FE Swiss Financial) with a Swiss-style minimalist UI, including a rebuilt sidebar navigation (Dashboard, Clients, Onboarding, KYC Screening, Reports, Settings), dashboard analytics, client list management (with Add New Client CTA on Clients page), detailed client profiles, onboarding kanban pipeline, KYC screening management with manual check entry, and compliance reporting views.",
  "architectural_notes": [
    "Add role/permission concept (at minimum: admin) and an initialization/bootstrap rule to assign admin to the first created record.",
    "Update IA/navigation: sidebar contains Dashboard, Clients, Onboarding, KYC Screening, Reports, Settings (Settings pinned near bottom before user profile); 'Add New Client' is a primary CTA on Clients page, not a sidebar item.",
    "Sidebar nav grouping: Dashboard/Clients/Onboarding/KYC Screening/Reports, then a separator, then Settings pinned just above the user profile/logout section; ensure main content layout accounts for sidebar width (no overlap).",
    "Client Detail page redesign: include a top alert bar for compliance warnings, a profile header with client ID format like HEL-2026-0001 and Edit/Download PDF actions, and a tabbed layout (Overview default + Identity & KYC, Documents, Financial Profile, Connections, Activity Log, Notes).",
    "Identity & KYC tab UI spec: Identity Documents displayed as cards; expiry countdown color thresholds (green >90d, orange 30–90d, red <30d/expired) + verified badge/date; KYC Screening History rendered as a table; Current Risk Assessment card includes Initiate New Screening CTA; populate with Swiss-oriented mock data (e.g., Swiss passport, B permit).",
    "Clients page layout: main content must be offset to the right of the ~220px sidebar so page title and search UI never overlap/cut off.",
    "Clients page header should include a prominent \"Add Client\" CTA aligned top-right next to the page title, navigating to the Add Client form route.",
    "Clients table should render 5 realistic Swiss mock client rows when backend data is unavailable to avoid empty-state table (names, status, risk, nationality, onboarding dates).",
    "Add Client form spec: sections Contact Details + Personal Data; First/Last required; Account ID auto-generated in format FES-YYYY-NNNN (e.g., FES-2026-0001); default Client Type=Individual with option Entity.",
    "Create Client flow: attempt backend canister save then navigate to Clients list; on failure, persist locally (fallback) and still navigate/show in list."
  ],
  "known_issues": [
    "Sidebar overlaps main content; main content area needs proper left margin/padding to account for sidebar width.",
    "Clients page content is still partially hidden under the left sidebar (insufficient left margin/padding).",
    "Add Client page: 'Create Client' button currently does nothing (no save/no navigation).",
    "Export PDF filename still incorrect: Caffeine platform overrides document/iframe titles even with iframe print approach; must stop using print-based flows and switch to direct jsPDF download to control filename.",
    "jsPDF-based Export PDF is not viable because the jsPDF library is not available in this project; revert to a popup-window print approach.",
    "Client Detail: Export PDF button currently does nothing (download/print flow not triggering); `downloadPDF` in `pdfDownload.ts` needs to be fixed.",
    "Client Detail: Edit Client button is broken; edit mode does not properly allow editing all fields and/or Save/Cancel does not persist/restore values as required.",
    "Client Overview edit mode: input fields render but are not editable (typing is frozen) due to controlled input state not updating `draftValues` correctly; React resets value each keystroke.",
    "Edit Client inputs still frozen in Overview edit mode; controlled-input state approach is resetting on render and must be replaced with uncontrolled inputs + FormData/ref-based Save collection (no other pages/features changed).",
    "Settings > Admin Management: deployer/caller is not auto-registered as Operator when admin list is empty (bootstrap missing)."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-create-the-frontend-application-layout-with-a-clean-professional-swiss-style-minimalist-aesthetic-and-a-persistent-sidebar-navigation-that-links-to-dashboard-clients-and-add-new-client",
      "title": "Create the frontend application layout with a clean, professional Swiss-style minimalist aesthetic and a persistent sidebar navigation that links to Dashboard, Clients, and Add New Client.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-dashboard-page-that-displays-total-clients-clients-by-status-clients-by-risk-level-and-a-list-of-upcoming-kyc-review-deadlines-populated-from-the-backend",
      "title": "Build a Dashboard page that displays: total clients, clients by status, clients by risk level, and a list of upcoming KYC review deadlines populated from the backend.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-clients-page-with-a-searchable-sortable-table-showing-client-name-status-risk-level-nationality-relationship-manager-and-onboarding-date-populated-from-the-backend",
      "title": "Build a Clients page with a searchable, sortable table showing: client name, status, risk level, nationality, relationship manager, and onboarding date, populated from the backend.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-client-detail-page-that-shows-full-profile-information-personal-details-name-dob-nationality-address-phone-email-kyc-status-with-history-of-checks-risk-rating-with-justification-onboarding-progress-steps-and-an-activity-log-all-populated-from-the-backend-for-the-selected-client",
      "title": "Build a Client Detail page that shows full profile information: personal details (name, DOB, nationality, address, phone, email), KYC status with history of checks, risk rating with justification, onboarding progress steps, and an activity log; all populated from the backend for the selected client.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-build-an-add-new-client-form-that-captures-all-personal-details-plus-client-type-individual-entity-and-creates-the-new-client-in-the-backend-after-creation-navigate-to-the-new-client-s-detail-page-or-clients-list-with-a-visible-confirmation",
      "title": "Build an Add New Client form that captures all personal details plus client type (individual/entity), and creates the new client in the backend; after creation, navigate to the new client’s detail page (or Clients list) with a visible confirmation.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-onboarding-page-that-renders-a-kanban-style-pipeline-with-exactly-these-columns-in-this-order-initial-contact-id-collection-kyc-screening-risk-assessment-compliance-review-account-activation",
      "title": "Add an \"Onboarding\" page that renders a kanban-style pipeline with exactly these columns in this order: Initial Contact, ID Collection, KYC Screening, Risk Assessment, Compliance Review, Account Activation.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-for-each-client-in-the-onboarding-pipeline-display-a-kanban-card-that-shows-client-name-step-status-assigned-person-and-due-date",
      "title": "For each client in the onboarding pipeline, display a kanban card that shows: client name, step status, assigned person, and due date.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-allow-users-to-move-clients-between-onboarding-stages-from-the-onboarding-kanban-ui-and-persist-the-updated-stage-and-any-edited-card-fields-if-applicable-to-the-backend",
      "title": "Allow users to move clients between onboarding stages from the Onboarding kanban UI and persist the updated stage (and any edited card fields, if applicable) to the backend.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-sidebar-navigation-in-frontend-src-components-applayout-tsx-to-add-three-items-after-onboarding-1-kyc-screening-with-a-shieldcheck-icon-linking-to-kyc-screening-2-reports-with-a-filebarchart-icon-linking-to-reports-then-render-a-visible-separator-line-then-3-settings-with-a-settings-gear-icon-linking-to-settings-positioned-just-above-the-user-profile-logout-section",
      "title": "Update the sidebar navigation in `frontend/src/components/AppLayout.tsx` to add three items after “Onboarding”: (1) “KYC Screening” with a ShieldCheck icon linking to `/kyc-screening`, (2) “Reports” with a FileBarChart icon linking to `/reports`, then render a visible separator line, then (3) “Settings” with a Settings (gear) icon linking to `/settings`, positioned just above the user profile/logout section.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-application-layout-so-the-sidebar-does-not-overlap-the-main-content-ensure-the-main-content-area-has-the-correct-left-inset-margin-padding-to-account-for-the-sidebar-width-across-supported-breakpoints",
      "title": "Fix the application layout so the sidebar does not overlap the main content; ensure the main content area has the correct left inset/margin/padding to account for the sidebar width across supported breakpoints.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-add-frontend-routes-for-kyc-screening-reports-and-settings-in-frontend-src-app-tsx-so-the-new-sidebar-links-resolve-without-navigation-errors-each-route-should-render-a-minimal-placeholder-page-with-a-clear-english-heading-matching-the-nav-label",
      "title": "Add frontend routes for `/kyc-screening`, `/reports`, and `/settings` in `frontend/src/App.tsx` so the new sidebar links resolve without navigation errors; each route should render a minimal placeholder page with a clear English heading matching the nav label.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-rebuild-the-clients-clientid-client-detail-page-ui-frontend-src-pages-clientdetailpage-tsx-to-match-the-requested-structure-1-a-top-alert-bar-with-colored-pill-badges-for-warnings-2-a-profile-header-showing-client-full-name-formatted-client-id-hel-yyyy-nnnn-status-badge-risk-level-badge-and-action-buttons-for-edit-and-download-pdf-and-3-a-horizontal-tab-bar-with-tabs-overview-default-identity-kyc-documents-financial-profile-connections-activity-log-notes",
      "title": "Rebuild the `/clients/$clientId` Client Detail page UI (`frontend/src/pages/ClientDetailPage.tsx`) to match the requested structure: (1) a top alert bar with colored pill badges for warnings, (2) a profile header showing client full name, formatted client ID `HEL-YYYY-NNNN`, status badge, risk level badge, and action buttons for “Edit” and “Download PDF”, and (3) a horizontal tab bar with tabs: Overview (default), Identity & KYC, Documents, Financial Profile, Connections, Activity Log, Notes.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-overview-tab-content-as-a-responsive-2-column-grid-of-6-card-sections-personal-information-contact-details-identity-documents-kyc-status-tax-information-financial-profile-each-section-must-list-the-requested-fields-and-display-a-small-grey-verified-yyyy-mm-dd-text-next-to-each-field-value",
      "title": "Implement the Overview tab content as a responsive 2-column grid of 6 card sections: Personal Information, Contact Details, Identity Documents, KYC Status, Tax Information, Financial Profile. Each section must list the requested fields and display a small grey “Verified: YYYY-MM-DD” text next to each field value.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-use-realistic-placeholder-mock-data-to-populate-the-new-sections-especially-the-overview-content-alert-badges-identity-documents-and-verified-dates-so-the-redesigned-client-detail-page-looks-complete-even-if-the-backend-client-model-does-not-yet-provide-these-fields-continue-to-use-the-existing-backend-query-usegetclient-for-the-core-client-record-used-in-the-header-name-status-risk-where-available",
      "title": "Use realistic placeholder/mock data to populate the new sections (especially the Overview content, alert badges, identity documents, and verified dates) so the redesigned Client Detail page looks complete even if the backend client model does not yet provide these fields; continue to use the existing backend query (`useGetClient`) for the core client record used in the header (name/status/risk) where available.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-placeholder-content-for-the-identity-kyc-tab-in-frontend-src-pages-clientdetailpage-tsx-with-real-ui-sections-populated-from-the-existing-mockdata-returned-by-generatemockclientdetail",
      "title": "Replace the placeholder content for the “Identity & KYC” tab in `frontend/src/pages/ClientDetailPage.tsx` with real UI sections populated from the existing `mockData` returned by `generateMockClientDetail`.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-identity-documents-section-in-the-identity-kyc-tab-as-a-card-section-with-an-add-document-button-and-a-list-grid-of-document-cards-each-document-card-must-display-document-type-passport-id-card-residence-permit-document-number-issuing-country-issue-date-expiry-date-a-color-coded-expiry-countdown-and-a-verified-badge-with-a-verified-date",
      "title": "Implement the “Identity Documents” section in the Identity & KYC tab as a card section with an “Add Document” button and a list/grid of document cards; each document card must display: document type (Passport/ID Card/Residence Permit), document number, issuing country, issue date, expiry date, a color-coded expiry countdown, and a verified badge with a verified date.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-kyc-screening-history-section-in-the-identity-kyc-tab-as-a-table-listing-all-past-screenings-with-columns-date-screening-type-initial-periodic-event-triggered-risk-level-result-pep-check-result-clear-match-sanctions-check-result-clear-hit-screened-by-user-name-and-notes",
      "title": "Implement the “KYC Screening History” section in the Identity & KYC tab as a table listing all past screenings with columns: Date, Screening Type (Initial/Periodic/Event-triggered), Risk Level Result, PEP Check Result (Clear/Match), Sanctions Check Result (Clear/Hit), Screened By (user name), and Notes.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-current-risk-assessment-section-in-the-identity-kyc-tab-as-a-card-showing-overall-risk-level-with-a-colored-badge-a-list-of-risk-factors-last-assessment-date-next-review-date-and-a-button-labeled-initiate-new-screening",
      "title": "Implement the “Current Risk Assessment” section in the Identity & KYC tab as a card showing: overall risk level with a colored badge, a list of risk factors, last assessment date, next review date, and a button labeled “Initiate New Screening”.",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-frontend-src-mocks-clientdetailmock-ts-mock-data-mockclientdetail-generatemockclientdetail-to-include-the-additional-fields-needed-for-the-identity-kyc-tab-issuing-country-verified-date-per-document-screening-history-rows-and-current-risk-assessment-details-using-realistic-swiss-oriented-mock-values-e-g-swiss-passport-swiss-permit-b-switzerland-issuing-country-swiss-style-names",
      "title": "Extend `frontend/src/mocks/clientDetailMock.ts` mock data (`MockClientDetail` + `generateMockClientDetail`) to include the additional fields needed for the Identity & KYC tab (issuing country, verified date per document, screening history rows, and current risk assessment details), using realistic Swiss-oriented mock values (e.g., Swiss passport, Swiss Permit B, Switzerland issuing country, Swiss-style names).",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-update-or-add-a-date-expiry-helper-in-frontend-src-utils-format-ts-or-a-new-helper-function-in-the-same-file-to-support-the-identity-documents-expiry-countdown-thresholds-required-by-the-identity-kyc-tab-green-90-days-orange-30-90-days-red-30-days-or-expired",
      "title": "Update or add a date/expiry helper in `frontend/src/utils/format.ts` (or a new helper function in the same file) to support the Identity Documents expiry countdown thresholds required by the Identity & KYC tab: green > 90 days, orange 30–90 days, red < 30 days or expired.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-layout-so-the-clients-page-main-content-page-title-and-search-bar-is-not-overlapped-cut-off-by-the-left-sidebar-ensure-the-main-content-starts-after-the-220px-sidebar-by-applying-a-correct-left-inset-margin-or-padding-at-the-application-layout-level",
      "title": "Fix the layout so the Clients page main content (page title and search bar) is not overlapped/cut off by the left sidebar; ensure the main content starts after the ~220px sidebar by applying a correct left inset (margin or padding) at the application layout level.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-prominent-add-client-button-in-the-clients-page-header-area-aligned-to-the-top-right-next-to-the-clients-title-that-navigates-to-the-add-client-form-route-at-add-client",
      "title": "Add a prominent \"Add Client\" button in the Clients page header area, aligned to the top-right next to the \"Clients\" title, that navigates to the Add Client form route at \"/add-client\".",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-populate-the-clients-table-with-5-realistic-swiss-oriented-mock-client-rows-when-the-backend-returns-an-empty-client-list-using-these-names-hans-mueller-sophie-dubois-marco-rossi-elena-fischer-philippe-bonvin-each-mock-row-must-include-realistic-status-risk-level-nationality-and-onboarding-date-values-so-the-table-does-not-appear-empty",
      "title": "Populate the Clients table with 5 realistic Swiss-oriented mock client rows when the backend returns an empty client list, using these names: Hans Mueller, Sophie Dubois, Marco Rossi, Elena Fischer, Philippe Bonvin; each mock row must include realistic status, risk level, nationality, and onboarding date values so the table does not appear empty.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-add-client-page-so-clicking-the-create-client-button-always-triggers-a-submission-flow-validate-required-fields-attempt-to-create-the-client-in-the-backend-canister-and-then-navigate-to-the-clients-list-page-clients",
      "title": "Fix the Add Client page so clicking the “Create Client” button always triggers a submission flow: validate required fields, attempt to create the client in the backend canister, and then navigate to the Clients list page (`/clients`).",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-add-client-form-ui-and-captured-data-model-to-match-the-requested-crm-fields-and-section-structure-including-an-auto-generated-account-id-in-the-format-fes-yyyy-nnnn-example-shown-fes-2026-0001-and-default-client-type-set-to-individual-with-an-option-for-entity",
      "title": "Update the Add Client form UI and captured data model to match the requested CRM fields and section structure, including an auto-generated Account ID in the format `FES-YYYY-NNNN` (example shown: `FES-2026-0001`) and default Client Type set to Individual with an option for Entity.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-on-add-client-submission-persist-the-new-client-to-the-backend-canister-when-possible-if-the-backend-save-fails-for-any-reason-store-the-client-locally-in-the-browser-and-still-navigate-to-clients-ensuring-the-locally-stored-client-appears-in-the-clients-list",
      "title": "On Add Client submission, persist the new client to the backend canister when possible; if the backend save fails for any reason, store the client locally in the browser and still navigate to `/clients`, ensuring the locally-stored client appears in the Clients list.",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-clients-list-so-it-always-shows-the-5-swiss-mock-clients-hans-mueller-sophie-dubois-marco-rossi-elena-fischer-philippe-bonvin-as-clickable-rows-regardless-of-whether-the-backend-returns-an-empty-or-non-empty-client-list-and-ensure-clicking-those-rows-successfully-navigates-to-a-working-client-detail-view",
      "title": "Update the Clients list so it always shows the 5 Swiss mock clients (Hans Mueller, Sophie Dubois, Marco Rossi, Elena Fischer, Philippe Bonvin) as clickable rows, regardless of whether the backend returns an empty or non-empty client list, and ensure clicking those rows successfully navigates to a working Client Detail view.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-modify-only-the-client-detail-page-overview-tab-ui-component-frontend-src-components-clients-clientoverviewtab-tsx-to-replace-the-existing-overview-content-with-exactly-6-sections-using-english-user-facing-labels-and-keep-all-other-pages-and-tabs-unchanged",
      "title": "Modify only the Client Detail page “Overview” tab UI (component: `frontend/src/components/clients/ClientOverviewTab.tsx`) to replace the existing Overview content with exactly 6 sections, using English user-facing labels, and keep all other pages and tabs unchanged.",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-in-the-overview-tab-render-the-6-sections-with-the-exact-fields-specified-by-the-user-including-checkbox-style-fields-for-the-specified-completed-confirmation-items-and-show-reasonable-placeholder-values-when-fields-are-not-available-from-existing-mockdata-without-changing-the-mockclientdetail-interface-used-by-other-tabs",
      "title": "In the Overview tab, render the 6 sections with the exact fields specified by the user, including checkbox-style fields for the specified “Completed”/confirmation items, and show reasonable placeholder values when fields are not available from existing `mockData` (without changing the `MockClientDetail` interface used by other tabs).",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-client-detail-page-header-frontend-src-pages-clientdetailpage-tsx-to-include-an-edit-client-button-positioned-next-to-the-existing-export-pdf-button-clicking-edit-client-must-toggle-an-edit-mode-for-the-overview-tab-and-replace-the-header-actions-with-save-and-cancel-controls-while-in-edit-mode",
      "title": "Update the Client Detail page header (`frontend/src/pages/ClientDetailPage.tsx`) to include an \"Edit Client\" button positioned next to the existing \"Export PDF\" button. Clicking \"Edit Client\" must toggle an edit mode for the Overview tab and replace the header actions with \"Save\" and \"Cancel\" controls while in edit mode.",
      "reqIds": [
        "REQ-35"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-editable-inputs-for-all-fields-rendered-in-the-6-overview-sections-in-frontend-src-components-clients-clientoverviewtab-tsx-when-edit-mode-is-enabled-inputs-must-cover-both-text-number-style-fields-and-checkbox-style-fields-and-must-preserve-the-existing-6-section-structure-and-english-labels",
      "title": "Implement editable inputs for all fields rendered in the 6 Overview sections in `frontend/src/components/clients/ClientOverviewTab.tsx` when edit mode is enabled. Inputs must cover both text/number-style fields and checkbox-style fields, and must preserve the existing 6-section structure and English labels.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-on-save-from-edit-mode-persist-the-updated-overview-field-values-for-the-current-client-and-ensure-the-persisted-values-are-shown-after-page-refresh-persistence-must-work-for-clients-loaded-from-a-backend-canister-usegetclient-b-locally-stored-clients-getlocalclient-and-c-mock-clients-if-backend-persistence-is-not-possible-for-a-given-client-source-store-the-updated-overview-values-locally-in-the-browser-for-that-client-id",
      "title": "On \"Save\" from edit mode, persist the updated Overview field values for the current client and ensure the persisted values are shown after page refresh. Persistence must work for clients loaded from: (a) backend canister (`useGetClient`), (b) locally stored clients (`getLocalClient`), and (c) mock clients. If backend persistence is not possible for a given client source, store the updated Overview values locally in the browser for that client ID.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-create-an-auditable-activity-log-entry-for-each-field-changed-during-an-overview-save-operation-each-entry-must-capture-timestamp-field-name-old-value-new-value-and-the-user-who-made-the-change-from-the-signed-in-user-profile-identity-append-these-entries-to-the-client-s-activity-log-in-persistent-storage-backend-when-available-otherwise-local-browser-storage-to-support-compliance-audit-trail",
      "title": "Create an auditable Activity Log entry for each field changed during an Overview \"Save\" operation. Each entry must capture: timestamp, field name, old value, new value, and the user who made the change (from the signed-in user profile / identity). Append these entries to the client’s activity log in persistent storage (backend when available; otherwise local browser storage) to support compliance audit trail.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-activity-log-tab-coming-soon-placeholder-in-frontend-src-pages-clientdetailpage-tsx-with-a-functional-activity-log-view-that-lists-the-saved-audit-entries-including-those-created-by-overview-edits-the-view-must-clearly-display-timestamp-field-name-old-value-new-value-and-user-using-english-column-headers",
      "title": "Replace the \"Activity Log tab coming soon\" placeholder in `frontend/src/pages/ClientDetailPage.tsx` with a functional Activity Log view that lists the saved audit entries (including those created by Overview edits). The view must clearly display timestamp, field name, old value, new value, and user, using English column headers.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-client-detail-page-frontend-src-pages-clientdetailpage-tsx-so-clicking-the-export-pdf-button-generates-and-downloads-a-pdf-file-instead-of-doing-nothing-without-changing-any-other-pages-or-features",
      "title": "Update the Client Detail page (`frontend/src/pages/ClientDetailPage.tsx`) so clicking the “Export PDF” button generates and downloads a PDF file (instead of doing nothing), without changing any other pages or features.",
      "reqIds": [
        "REQ-40"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-generated-pdf-content-includes-in-order-1-a-header-containing-the-text-helvetica-logo-text-the-client-full-name-the-client-account-id-and-the-current-date-and-2-clearly-labeled-table-formatted-sections-for-all-6-overview-sections-contact-details-personal-data-mandate-wallets-compliance-and-vqf-with-field-names-and-values-rendered-in-a-clean-readable-layout",
      "title": "Ensure the generated PDF content includes (in order): (1) a header containing the text “HELVETICA” (logo text), the client full name, the client Account ID, and the current date; and (2) clearly labeled, table-formatted sections for all 6 Overview sections: Contact Details, Personal Data, Mandate, Wallets, Compliance, and VQF, with field names and values rendered in a clean, readable layout.",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    },
    {
      "id": "feature-generate-the-pdf-using-either-a-a-browser-print-to-pdf-approach-or-b-a-client-side-pdf-library-e-g-jspdf-and-set-the-downloaded-filename-to-clientname-accountid-date-pdf-using-the-client-s-name-account-id-and-the-current-date",
      "title": "Generate the PDF using either (a) a browser print-to-PDF approach or (b) a client-side PDF library (e.g., jsPDF), and set the downloaded filename to `ClientName_AccountID_Date.pdf` using the client’s name, Account ID, and the current date.",
      "reqIds": [
        "REQ-42"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-client-detail-page-export-pdf-flow-so-the-browser-print-to-pdf-suggested-filename-uses-the-format-clientname-accountid-date-by-temporarily-overriding-document-title-immediately-before-printing-and-restoring-the-original-title-immediately-after-printing-even-if-printing-throws-use-the-same-client-name-account-id-date-values-already-used-to-build-the-filename-in-frontend-src-pages-clientdetailpage-tsx-example-hans-mueller-fes-2024-0001-2026-02-18-keep-all-other-pages-and-features-unchanged",
      "title": "Fix the Client Detail page “Export PDF” flow so the browser print-to-PDF suggested filename uses the format \"ClientName_AccountID_Date\" by temporarily overriding `document.title` immediately before printing and restoring the original title immediately after printing (even if printing throws). Use the same client name/account ID/date values already used to build the `filename` in `frontend/src/pages/ClientDetailPage.tsx` (example: \"Hans_Mueller_FES-2024-0001_2026-02-18\"). Keep all other pages and features unchanged.",
      "reqIds": [
        "REQ-43"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-client-detail-page-export-pdf-flow-to-stop-relying-on-document-title-and-the-main-window-print-flow-and-instead-use-a-hidden-iframe-whose-own-document-title-is-set-to-the-client-based-filename-format-before-triggering-printing",
      "title": "Update the Client Detail page Export PDF flow to stop relying on `document.title` and the main window print flow, and instead use a hidden iframe whose own document title is set to the client-based filename format before triggering printing.",
      "reqIds": [
        "REQ-44"
      ],
      "version": 1
    },
    {
      "id": "feature-refactor-frontend-src-utils-pdfdownload-ts-so-downloadpdf-sets-the-iframe-document-title-and-or-injects-the-desired-title-into-the-iframe-html-instead-of-overriding-the-parent-document-title-then-triggers-iframe-contentwindow-print-and-reliably-cleans-up-the-iframe-afterward",
      "title": "Refactor `frontend/src/utils/pdfDownload.ts` so `downloadPDF()` sets the iframe document title (and/or injects the desired `<title>` into the iframe HTML) instead of overriding the parent `document.title`, then triggers `iframe.contentWindow.print()` and reliably cleans up the iframe afterward.",
      "reqIds": [
        "REQ-45"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-print-iframe-based-pdf-export-implementation-in-frontend-src-utils-pdfdownload-ts-with-a-jspdf-based-implementation-that-programmatically-creates-a-pdf-in-memory-and-triggers-a-direct-download-using-url-createobjecturl-plus-an-a-tag-click-with-the-download-attribute-set-to-the-requested-filename",
      "title": "Replace the print/iframe-based PDF export implementation in `frontend/src/utils/pdfDownload.ts` with a jsPDF-based implementation that programmatically creates a PDF in memory and triggers a direct download using `URL.createObjectURL()` plus an `<a>` tag click with the `download` attribute set to the requested filename.",
      "reqIds": [
        "REQ-46"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-pages-clientdetailpage-tsx-to-use-the-new-jspdf-based-downloadpdf-flow-and-generate-the-download-filename-in-the-exact-format-firstname-lastname-accountid-yyyy-mm-dd-pdf-using-the-existing-sanitizefilename-and-formatdateforfilename-helpers",
      "title": "Update `frontend/src/pages/ClientDetailPage.tsx` to use the new jsPDF-based `downloadPDF()` flow and generate the download filename in the exact format `FirstName_LastName_AccountID_YYYY-MM-DD.pdf` using the existing `sanitizeFilename()` and `formatDateForFilename()` helpers.",
      "reqIds": [
        "REQ-47"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-jspdf-based-export-remains-compatible-with-the-current-pdf-content-generation-call-site-in-clientdetailpage-tsx-which-currently-passes-htmlcontent-from-generateclientpdf-client-mockdetaildata-without-changing-any-other-files",
      "title": "Ensure the jsPDF-based export remains compatible with the current PDF content generation call site in `ClientDetailPage.tsx` (which currently passes `htmlContent` from `generateClientPDF(client, mockDetailData)`), without changing any other files.",
      "reqIds": [
        "REQ-48"
      ],
      "version": 1
    },
    {
      "id": "feature-rework-frontend-src-utils-pdfdownload-ts-so-downloadpdf-htmlcontent-filename-no-longer-uses-jspdf-html2canvas-including-any-dynamic-cdn-loading-and-instead-exports-via-a-simple-popup-window-print-flow-1-window-open-a-new-blank-popup-window-2-write-the-full-htmlcontent-into-the-popup-via-popupwindow-document-write-htmlcontent-3-set-popupwindow-document-title-to-the-provided-filename-example-hans-mueller-fes-2024-0001-2026-02-18-4-call-popupwindow-print-and-5-close-the-popup-after-printing",
      "title": "Rework `frontend/src/utils/pdfDownload.ts` so `downloadPDF(htmlContent, filename)` no longer uses jsPDF/html2canvas (including any dynamic CDN loading), and instead exports via a simple popup-window print flow: (1) `window.open` a new blank popup window, (2) write the full `htmlContent` into the popup via `popupWindow.document.write(htmlContent)`, (3) set `popupWindow.document.title` to the provided `filename` (example: \"Hans_Mueller_FES-2024-0001_2026-02-18\"), (4) call `popupWindow.print()`, and (5) close the popup after printing.",
      "reqIds": [
        "REQ-49"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-pages-clientdetailpage-tsx-so-the-export-pdf-action-builds-a-filename-string-from-the-client-s-firstname-lastname-accountid-and-today-s-date-and-passes-that-filename-string-to-downloadpdf-pdfhtml-filename-keep-generateclientpdf-client-mockdetaildata-unchanged-and-keep-all-other-pages-unchanged",
      "title": "Update `frontend/src/pages/ClientDetailPage.tsx` so the Export PDF action builds a filename string from the client’s `firstName`, `lastName`, `accountId`, and today’s date, and passes that filename string to `downloadPDF(pdfHtml, filename)`. Keep `generateClientPDF(client, mockDetailData)` unchanged and keep all other pages unchanged.",
      "reqIds": [
        "REQ-50"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-utils-pdfdownload-ts-so-downloadpdf-htmlcontent-filename-uses-a-blob-url-approach-instead-of-the-current-popup-window-document-write-flow-to-ensure-the-client-detail-page-export-pdf-action-reliably-opens-and-triggers-printing-implementation-requirements-for-downloadpdf-htmlcontent-filename-create-a-new-html-string-from-htmlcontent-that-injects-overrides-a-title-element-in-the-head-to-exactly-filename-append-an-auto-print-script-at-the-end-of-the-body-that-triggers-printing-automatically-after-the-document-loads-and-closes-the-tab-window-afterward-when-possible-create-a-blob-from-the-final-html-string-with-mime-type-text-html-create-a-blob-url-with-url-createobjecturl-blob-open-the-blob-url-in-a-new-tab-via-window-open-bloburl-clean-up-the-blob-url-via-url-revokeobjecturl-bloburl-at-an-appropriate-time-so-it-does-not-leak-memory-do-not-change-generateclientpdf-or-frontend-src-pages-clientdetailpage-tsx-the-existing-call-site-must-keep-working-unchanged",
      "title": "Update `frontend/src/utils/pdfDownload.ts` so `downloadPDF(htmlContent, filename)` uses a Blob URL approach (instead of the current popup-window `document.write` flow) to ensure the Client Detail page “Export PDF” action reliably opens and triggers printing.\n\nImplementation requirements for `downloadPDF(htmlContent, filename)`:\n- Create a new HTML string from `htmlContent` that injects/overrides a `<title>` element in the `<head>` to exactly `filename`.\n- Append an auto-print script at the end of the `<body>` that triggers printing automatically after the document loads (and closes the tab/window afterward when possible).\n- Create a `Blob` from the final HTML string with MIME type `text/html`.\n- Create a Blob URL with `URL.createObjectURL(blob)`.\n- Open the Blob URL in a new tab via `window.open(blobUrl)`.\n- Clean up the Blob URL via `URL.revokeObjectURL(blobUrl)` at an appropriate time so it does not leak memory.\n\nDo not change `generateClientPDF` or `frontend/src/pages/ClientDetailPage.tsx`; the existing call site must keep working unchanged.",
      "reqIds": [
        "REQ-51"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-client-detail-page-edit-client-workflow-so-that-clicking-edit-client-correctly-enters-edit-mode-for-the-overview-tab-and-makes-every-field-in-all-6-overview-sections-contact-details-personal-data-mandate-wallets-compliance-vqf-editable-as-a-text-input-allowing-the-user-to-type-new-values-into-any-field",
      "title": "Fix the Client Detail page “Edit Client” workflow so that clicking “Edit Client” correctly enters edit mode for the Overview tab and makes every field in all 6 Overview sections (Contact Details, Personal Data, Mandate, Wallets, Compliance, VQF) editable as a text input, allowing the user to type new values into any field.",
      "reqIds": [
        "REQ-52"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-correct-save-cancel-behavior-for-the-overview-edit-mode-save-persists-the-edited-values-and-displays-them-after-save-cancel-discards-edits-and-restores-the-original-values-shown-before-entering-edit-mode",
      "title": "Implement correct Save/Cancel behavior for the Overview edit mode: Save persists the edited values and displays them after save; Cancel discards edits and restores the original values shown before entering edit mode.",
      "reqIds": [
        "REQ-53"
      ],
      "version": 1
    },
    {
      "id": "feature-persist-overview-edits-to-browser-localstorage-so-that-saved-changes-survive-page-refresh-using-a-per-client-key-strategy-loading-the-client-detail-page-must-hydrate-the-overview-display-from-localstorage-when-present-for-that-client-id",
      "title": "Persist Overview edits to browser localStorage so that saved changes survive page refresh, using a per-client key strategy. Loading the Client Detail page must hydrate the Overview display from localStorage (when present) for that client ID.",
      "reqIds": [
        "REQ-54"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-strict-change-scope-only-modify-frontend-src-pages-clientdetailpage-tsx-and-frontend-src-components-clients-clientoverviewtab-tsx-to-deliver-the-edit-client-fix-do-not-modify-any-other-files-or-any-export-pdf-functionality",
      "title": "Apply strict change scope: only modify `frontend/src/pages/ClientDetailPage.tsx` and `frontend/src/components/clients/ClientOverviewTab.tsx` to deliver the Edit Client fix; do not modify any other files or any Export PDF functionality.",
      "reqIds": [
        "REQ-55"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-react-controlled-input-bug-in-frontend-src-components-clients-clientoverviewtab-tsx-so-that-in-overview-edit-mode-users-can-type-into-every-field-input-and-each-keystroke-updates-the-draft-state-no-value-freezing-or-resetting-specifically-1-in-edit-mode-each-fieldrow-input-must-render-its-value-from-draftvalues-fieldname-when-present-falling-back-to-the-current-display-value-and-2-each-input-must-call-onfieldchange-fieldname-e-target-value-on-every-change-so-the-parent-draft-record-updates-continuously",
      "title": "Fix the React controlled-input bug in `frontend/src/components/clients/ClientOverviewTab.tsx` so that, in Overview edit mode, users can type into every field input and each keystroke updates the draft state (no value “freezing” or resetting). Specifically: (1) in edit mode, each `FieldRow` `<Input>` must render its `value` from `draftValues[fieldName]` when present, falling back to the current display value; and (2) each `<Input>` must call `onFieldChange(fieldName, e.target.value)` on every change so the parent draft record updates continuously.",
      "reqIds": [
        "REQ-56"
      ],
      "version": 1
    },
    {
      "id": "feature-in-the-client-detail-overview-edit-workflow-replace-the-current-react-controlled-input-approach-with-an-uncontrolled-input-approach-so-users-can-type-into-every-field-specifically-in-frontend-src-components-clients-clientoverviewtab-tsx-when-iseditmode-is-true-render-each-editable-input-using-defaultvalue-currentvalue-not-value-and-ensure-each-input-has-a-name-attribute-that-exactly-matches-its-field-key-e-g-firstname-passportexpirydate-videoidcompleted-etc-do-not-rely-on-draftvalues-state-to-drive-the-inputs-while-typing",
      "title": "In the Client Detail Overview edit workflow, replace the current React controlled-input approach with an uncontrolled-input approach so users can type into every field. Specifically: in `frontend/src/components/clients/ClientOverviewTab.tsx`, when `isEditMode` is true, render each editable `<Input>` using `defaultValue={currentValue}` (not `value={...}`) and ensure each input has a `name` attribute that exactly matches its field key (e.g., `firstName`, `passportExpiryDate`, `videoIdCompleted`, etc.). Do not rely on `draftValues` state to drive the inputs while typing.",
      "reqIds": [
        "REQ-57"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-pages-clientdetailpage-tsx-and-frontend-src-components-clients-clientoverviewtab-tsx-so-the-save-operation-collects-updated-overview-values-from-the-dom-via-a-form-ref-formdata-instead-of-using-react-draft-state-wrap-the-overview-edit-inputs-in-a-form-element-either-in-clientdetailpage-tsx-around-the-overview-tab-content-or-inside-clientoverviewtab-tsx-and-store-a-useref-htmlformelement-to-it-when-save-is-clicked-call-new-formdata-formref-current-to-build-the-updated-overview-object-keyed-by-input-name-then-run-the-existing-change-detection-persistence-backend-where-supported-local-overrides-and-activity-log-append-flows-based-on-the-formdata-derived-values-cancel-must-discard-unsaved-changes-by-exiting-edit-mode-without-persisting-anything",
      "title": "Update `frontend/src/pages/ClientDetailPage.tsx` and `frontend/src/components/clients/ClientOverviewTab.tsx` so the Save operation collects updated Overview values from the DOM via a form ref + `FormData`, instead of using React draft state. Wrap the Overview edit inputs in a `<form>` element (either in `ClientDetailPage.tsx` around the Overview tab content or inside `ClientOverviewTab.tsx`) and store a `useRef<HTMLFormElement>` to it. When “Save” is clicked, call `new FormData(formRef.current)` to build the updated overview object keyed by input `name`, then run the existing change detection, persistence (backend where supported + local overrides), and activity log append flows based on the FormData-derived values. Cancel must discard unsaved changes by exiting edit mode without persisting anything.",
      "reqIds": [
        "REQ-58"
      ],
      "version": 1
    },
    {
      "id": "feature-limit-the-change-scope-strictly-to-the-two-files-involved-in-the-bug-frontend-src-pages-clientdetailpage-tsx-and-frontend-src-components-clients-clientoverviewtab-tsx-do-not-modify-any-other-pages-tabs-utilities-including-pdf-export-backend-code-or-shared-ui-components",
      "title": "Limit the change scope strictly to the two files involved in the bug: `frontend/src/pages/ClientDetailPage.tsx` and `frontend/src/components/clients/ClientOverviewTab.tsx`. Do not modify any other pages, tabs, utilities (including PDF export), backend code, or shared UI components.",
      "reqIds": [
        "REQ-59"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-client-detail-page-activity-log-tab-to-display-a-newest-first-chronological-table-of-client-change-events-with-exactly-these-columns-english-labels-date-user-action-details-ip-the-tab-must-render-log-entries-stored-in-localstorage-per-client-id-and-may-also-include-any-existing-backend-provided-entries-if-present-and-must-show-an-empty-state-message-when-no-entries-exist",
      "title": "Update the Client Detail page Activity Log tab to display a newest-first chronological table of client change events with exactly these columns (English labels): Date, User, Action, Details, IP. The tab must render log entries stored in localStorage per client ID (and may also include any existing backend-provided entries if present), and must show an empty state message when no entries exist.",
      "reqIds": [
        "REQ-60"
      ],
      "version": 1
    },
    {
      "id": "feature-on-client-detail-overview-edit-mode-save-compare-the-submitted-formdata-values-against-the-original-values-captured-when-entering-edit-mode-and-append-one-activity-log-entry-per-changed-field-to-localstorage-under-a-per-client-id-key-each-entry-must-include-timestamp-date-time-user-name-and-email-from-the-logged-in-user-profile-action-type-updated-details-containing-field-name-old-value-new-value-and-ip-address-fetched-from-https-api-ipify-org-or-a-placeholder-if-unavailable",
      "title": "On Client Detail Overview edit-mode Save, compare the submitted FormData values against the original values captured when entering edit mode, and append one Activity Log entry per changed field to localStorage under a per-client-ID key. Each entry must include: timestamp (date+time), user name and email (from the logged-in user profile), action type \"Updated\", details containing field name + old value + new value, and IP address (fetched from https://api.ipify.org or a placeholder if unavailable).",
      "reqIds": [
        "REQ-61"
      ],
      "version": 1
    },
    {
      "id": "feature-on-client-detail-export-pdf-action-append-a-single-activity-log-entry-in-localstorage-for-the-current-client-id-with-action-type-exported-pdf-including-timestamp-date-time-user-name-and-email-ip-address-api-ipify-org-or-placeholder-and-details-indicating-the-export-occurred-and-may-include-the-generated-filename",
      "title": "On Client Detail \"Export PDF\" action, append a single Activity Log entry in localStorage for the current client ID with action type \"Exported PDF\", including timestamp (date+time), user name and email, IP address (api.ipify.org or placeholder), and Details indicating the export occurred (and may include the generated filename).",
      "reqIds": [
        "REQ-62"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-frontend-authorization-gating-after-internet-identity-login-if-the-logged-in-principal-is-not-present-in-the-backend-authorized-table-render-an-access-denied-screen-that-says-exactly-your-principal-id-is-not-authorized-contact-the-administrator",
      "title": "Enforce frontend authorization gating after Internet Identity login: if the logged-in Principal is not present in the backend authorized table, render an Access Denied screen that says exactly: \"Your Principal ID is not authorized. Contact the administrator.\"",
      "reqIds": [
        "REQ-66"
      ],
      "version": 1
    },
    {
      "id": "feature-when-a-user-is-authorized-display-their-authorized-display-name-and-role-operator-staff-in-the-application-header-or-sidebar",
      "title": "When a user is authorized, display their authorized display name and role (Operator/Staff) in the application header or sidebar.",
      "reqIds": [
        "REQ-67"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-settings-page-ui-to-include-an-admin-management-section-showing-the-backend-allowlist-in-a-table-with-columns-principal-id-name-role-date-added-and-a-remove-button-remove-visible-only-for-operator-include-an-add-staff-form-with-fields-principal-id-and-display-name",
      "title": "Extend the Settings page UI to include an \"Admin Management\" section showing the backend allowlist in a table with columns: Principal ID, Name, Role, Date Added, and a Remove button (Remove visible only for Operator). Include an \"Add Staff\" form with fields: Principal ID and Display Name.",
      "reqIds": [
        "REQ-68"
      ],
      "version": 1
    },
    {
      "id": "feature-add-react-query-hooks-for-admin-management-backend-calls-current-authorization-entry-list-authorized-entries-add-staff-remove-staff-and-integrate-them-into-the-settings-page-and-authorization-gate",
      "title": "Add React Query hooks for Admin Management backend calls (current authorization entry, list authorized entries, add staff, remove staff) and integrate them into the Settings page and authorization gate.",
      "reqIds": [
        "REQ-69"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-settings-admin-management-ui-so-that-when-the-logged-in-user-is-the-operator-an-add-staff-form-is-visible-with-exactly-these-fields-principal-id-and-display-name-plus-an-add-button-that-adds-a-staff-entry-via-the-existing-add-admin-mutation",
      "title": "Fix the Settings > Admin Management UI so that when the logged-in user is the Operator, an “Add Staff” form is visible with exactly these fields: Principal ID and Display Name, plus an Add button that adds a Staff entry via the existing add-admin mutation.",
      "reqIds": [
        "REQ-72"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-settings-admin-management-table-rendering-to-match-these-columns-in-this-order-principal-id-name-role-date-added-remove-button-only-show-the-remove-button-for-operator-users-and-never-show-remove-on-the-operator-s-own-row",
      "title": "Fix the Settings > Admin Management table rendering to match these columns in this order: Principal ID, Name, Role, Date Added, Remove button; only show the Remove button for Operator users, and never show Remove on the Operator’s own row.",
      "reqIds": [
        "REQ-73"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-frontend-operator-detection-logic-used-by-admin-management-so-it-uses-the-backend-current-caller-admin-entry-endpoint-instead-of-the-current-broken-heuristic-and-correctly-enables-operator-only-ui-add-staff-form-remove-buttons-when-appropriate",
      "title": "Fix the frontend Operator detection logic used by Admin Management so it uses the backend “current caller admin entry” endpoint (instead of the current broken heuristic) and correctly enables Operator-only UI (Add Staff form + Remove buttons) when appropriate.",
      "reqIds": [
        "REQ-74"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-operator-detection-logic-in-frontend-src-components-settings-adminmanagementsection-tsx-so-that-the-add-staff-form-is-visible-when-and-only-when-the-logged-in-user-s-principal-id-matches-the-principal-id-of-the-operator-entry-in-the-admin-entries-table-returned-by-usegetadminentries-backend-getadminentries-do-not-rely-solely-on-usegetmyadminentry-for-this-ui-gate-instead-compute-isoperator-using-a-direct-principal-id-comparison-against-the-operator-row-in-adminentries-with-usegetmyadminentry-allowed-only-as-an-optional-fallback-if-needed",
      "title": "Fix the Operator detection logic in `frontend/src/components/settings/AdminManagementSection.tsx` so that the Add Staff form is visible when (and only when) the logged-in user’s Principal ID matches the Principal ID of the Operator entry in the admin entries table returned by `useGetAdminEntries()` (backend `getAdminEntries`). Do not rely solely on `useGetMyAdminEntry()` for this UI gate; instead, compute `isOperator` using a direct Principal ID comparison against the Operator row in `adminEntries` (with `useGetMyAdminEntry()` allowed only as an optional fallback if needed).",
      "reqIds": [
        "REQ-75"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-settings-admin-management-ui-renders-the-add-staff-form-directly-below-the-admin-entries-table-with-exactly-a-principal-id-text-input-a-display-name-text-input-and-an-add-staff-button-using-english-user-facing-labels-and-validation-messaging-the-add-staff-action-must-call-the-existing-backend-mutation-via-the-existing-react-query-hook-to-add-the-provided-principal-id-with-role-staff",
      "title": "Ensure the Settings > Admin Management UI renders the Add Staff form directly below the admin entries table with exactly: a Principal ID text input, a Display Name text input, and an “Add Staff” button, using English user-facing labels and validation messaging. The Add Staff action must call the existing backend mutation (via the existing React Query hook) to add the provided Principal ID with role `Staff`.",
      "reqIds": [
        "REQ-76"
      ],
      "version": 1
    },
    {
      "id": "feature-after-a-successful-add-staff-operation-refresh-the-admin-entries-table-so-the-newly-added-staff-entry-appears-also-enforce-correct-remove-button-behavior-show-a-remove-button-for-each-non-operator-row-only-when-the-logged-in-user-is-the-operator-never-show-a-remove-button-on-the-operator-row",
      "title": "After a successful Add Staff operation, refresh the admin entries table so the newly added Staff entry appears. Also enforce correct Remove button behavior: show a Remove button for each non-Operator row only when the logged-in user is the Operator; never show a Remove button on the Operator row.",
      "reqIds": [
        "REQ-77"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Dashboard showing client statistics (total clients; clients by status: prospect/onboarding/active/offboarded; clients by risk level: low/medium/high) and upcoming KYC review deadlines list",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Clients page with searchable, sortable table (client name, status, risk level, nationality, relationship manager, onboarding date)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Client detail page with full profile: personal details, KYC status with history, risk rating with justification, onboarding progress steps, and activity log",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Add New Client form capturing personal details plus client type (individual/entity)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Clean, professional Swiss-style minimalist aesthetic with sidebar navigation",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Implement a Motoko backend data model and CRUD APIs for CRM clients, including: client profile (personal details + client type individual/entity), client status (prospect/onboarding/active/offboarded), risk level (low/medium/high) with justification, relationship manager, onboarding date, KYC review due date, KYC check history entries, onboarding progress steps, and an activity log.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Implement backend dashboard query APIs that return: total client count, counts by client status (prospect/onboarding/active/offboarded), counts by risk level (low/medium/high), and a list of upcoming KYC review deadlines sorted by soonest due date.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Make the first created client/user an admin (bootstrap initial admin role for the CRM)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Implement an admin bootstrap flow in the Motoko backend so that the first user to set up a profile becomes an admin automatically, enabling them to create/manage clients without manual role assignment.",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Rebuild left sidebar navigation with items in exact order and appropriate icons: Dashboard, Clients, Onboarding, KYC Screening, Reports, Settings (Settings placed at bottom before user profile)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Move 'Add New Client' entry out of sidebar; add prominent 'Add New Client' button at top of Clients page",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Onboarding page: kanban-style pipeline view with steps (Initial Contact, ID Collection, KYC Screening, Risk Assessment, Compliance Review, Account Activation); cards show client name, step status, assigned person, and due date",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "KYC Screening page: list clients with last screening date, next review date, PEP status, sanctions status, and risk rating; per-client 'Run Manual Check' button opens form to enter screening results (document type/number, issue/expiry dates, PEP yes/no, sanctions clear/hit, notes)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Reports page: generate/view on-screen compliance reports (client risk distribution, overdue KYC reviews, onboarding status summary, full client compliance report)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Persist onboarding pipeline data in the backend so the Onboarding page can be populated from the canister, including each client’s current onboarding stage (one of the 6 stages), step status, assigned person, and due date.",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Fix sidebar layout so it does not overlap main content (ensure main content has proper left margin) and add a separator line between primary nav items (after Reports) and Settings section.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Rebuild Client Detail page UI: top alert bar with warning pill badges; profile header with client name, formatted client ID (HEL-2026-0001), status/risk badges, Edit + Download PDF actions; tabbed sections (Overview default, Identity & KYC, Documents, Financial Profile, Connections, Activity Log, Notes); Overview shows 2-column card grid with realistic placeholder data and per-field 'Verified: YYYY-MM-DD' text, including identity document expiry countdown styling",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-20",
      "summary": "Build Client Detail 'Identity & KYC' tab content: Identity Documents cards (type/number/country/issue/expiry with green>90d orange 30-90d red<30d or expired + verified badge/date + Add Document), KYC Screening History table (date, type, risk result, PEP result, sanctions result, screened by, notes), and Current Risk Assessment card (risk badge, risk factors, last assessment, next review, Initiate New Screening) using Swiss-oriented mock data",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Clients page: ensure main content is not cut off by the ~220px sidebar (proper left margin/padding); add prominent \"Add Client\" button in top-right of header next to title linking to Add Client form; populate table with 5 realistic Swiss mock clients (Hans Mueller, Sophie Dubois, Marco Rossi, Elena Fischer, Philippe Bonvin) including status, risk level, nationality, onboarding date",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Fix Add Client page: Create Client button must save to backend and navigate to Clients list; if backend save fails, store client locally and still navigate/show in list",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Update Add Client form fields/sections to match CRM: Contact Details (First/Last required, auto-generated Account ID FES-YYYY-NNNN, Email, Phone, Address, Primary Country) + Personal Data (DOB, Nationality, Passport Number/Expiry, Place of Birth, TIN); default Client Type=Individual with optional Entity",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Clients list: always show 5 Swiss mock clients even when backend returns empty; rows must be clickable and navigate to client detail page",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Extend the backend client data model and APIs so the backend can store the Add Client CRM fields (First Name, Last Name, Account ID, Email, Phone, Address, Primary Country, Date of Birth, Nationality, Passport Number, Passport Expiry Date, Place of Birth, TIN) while preserving existing client functionality.",
      "reqIds": [
        "REQ-31"
      ],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Client Detail page: modify Overview tab only—replace Personal Information and Contact Details with 6 new sections (Contact Details, Personal Data, Mandate, Wallets, Compliance, VQF) and display specified fields/checkboxes/dates; keep all other pages unchanged",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Client Detail page: add \"Edit Client\" button next to Export PDF in header; toggles Overview tab’s 6 sections into editable inputs with Save/Cancel; on Save persist changes and append Activity Log audit entry per field change (timestamp, field name, old value, new value, user) for compliance",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Implement functional Export PDF on Client Detail page: generate/download a PDF containing all 6 Overview sections (Contact Details, Personal Data, Mandate, Wallets, Compliance, VQF) with HELVETICA header (logo text, client name, Account ID, current date), clean table layout, and filename ClientName_AccountID_Date.pdf; keep all other pages unchanged",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Fix Export PDF so it works by updating `pdfDownload.ts` `downloadPDF(htmlContent, filename)` to use a Blob URL approach (Blob type `text/html`, inject <title> with filename, append auto-print script, `URL.createObjectURL`, `window.open(blobUrl)`), keeping `generateClientPDF` and `ClientDetailPage` unchanged",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Client Detail Activity Log: implement Activity Log tab showing newest-first table (Date, User name+email, Action: Created/Updated/Exported PDF, Details with field-level old/new, IP via api.ipify.org or placeholder); on Overview Save compare FormData vs original and append one log entry per changed field; store logs in localStorage per client ID; do not change Edit Client behavior or other pages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Add Settings > Admin Management with Motoko backend authorized Principal allowlist (stable var) + Operator/Staff roles: deployer auto-Operator, Operator-only add/remove (Operator not removable); enforce Internet Identity access control (unauthorized -> Access Denied page), show authorized user name+role in header/sidebar; Settings UI table + Add Staff form; do not change other features",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "Implement an Admin allowlist in the Motoko backend stored in stable state, where each authorized entry contains: Principal ID, display name, role (Operator or Staff), and date added.",
      "reqIds": [
        "REQ-63"
      ],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Bootstrap authorization so the canister deployer is the initial Operator, and enforce Operator-only mutation rules: only the Operator can add or remove other authorized Principals; the Operator entry cannot be removed.",
      "reqIds": [
        "REQ-64"
      ],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Add a backend authorization check API that allows the frontend to verify whether the currently authenticated caller Principal is authorized, without requiring the caller to already have user/admin permissions.",
      "reqIds": [
        "REQ-65"
      ],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Update the Motoko backend so that when the admin allowlist is empty and a caller invokes the admin list endpoint (`getAdminEntries`), the backend auto-registers the CALLER as an Operator with display name exactly \"System Administrator\" and sets `addedOn` to the current time, then returns the resulting admin entries list.",
      "reqIds": [
        "REQ-70"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Add a backend endpoint that returns the current caller’s admin allowlist entry (or null when not present) so the frontend can reliably determine whether the logged-in user is the Operator without fetching and guessing from the full list.",
      "reqIds": [
        "REQ-71"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "FE Swiss Financial",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}