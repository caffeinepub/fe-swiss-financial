{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Revert PDF export to popup-window print flow (no jsPDF)",
  "requirements": [
    {
      "id": "REQ-49",
      "summary": "Replace jsPDF/html2canvas-based PDF generation with a popup-window print flow in downloadPDF().",
      "acceptanceCriteria": [
        "`downloadPDF()` does not load or reference jsPDF or html2canvas and does not use Blob/objectURL download logic.",
        "Calling `downloadPDF(htmlContent, filename)` opens a new window and writes `htmlContent` into it via `document.write`.",
        "The popup window’s `document.title` is set exactly to the passed `filename` string before calling `print()`.",
        "`popupWindow.print()` is invoked and the popup window is closed after the print dialog completes (use an `afterprint`-based mechanism and a safe fallback if needed).",
        "If the popup cannot be opened (e.g., blocked), `downloadPDF()` fails gracefully with a clear English message (console error is acceptable; a simple user-facing alert is also acceptable)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/pdfDownload.ts",
          "operation": "modify",
          "description": "Rework `downloadPDF(htmlContent, filename)` to: open a blank popup via `window.open`, write the full `htmlContent` via `popupWindow.document.write(htmlContent)`, set `popupWindow.document.title = filename`, call `popupWindow.print()`, and close the popup after printing using an `afterprint` listener plus a safe fallback timer. Remove all jsPDF/html2canvas types, dynamic CDN script loading helpers, and any Blob/objectURL download logic. If the popup is blocked/unavailable, fail gracefully with a clear English console error and/or alert."
        }
      ]
    },
    {
      "id": "REQ-50",
      "summary": "Update ClientDetailPage Export PDF action to build and pass a filename from client name, accountId, and today’s date.",
      "acceptanceCriteria": [
        "`ClientDetailPage.tsx` continues to generate HTML via `generateClientPDF(client, mockDetailData)` without modifying `generateClientPDF`.",
        "Export PDF calls `downloadPDF(pdfHtml, filename)` where `filename` is derived from `firstName`, `lastName`, `accountId`, and today’s date (using existing filename-sanitization/date helpers where applicable).",
        "No other routes/pages/components are modified as part of this change."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/ClientDetailPage.tsx",
          "operation": "modify",
          "description": "Adjust the Export PDF handler to build `filename` from `client.firstName`, `client.lastName`, `client.accountId` (or existing fallback), and today's date using existing `sanitizeFilename()` and `formatDateForFilename()` helpers, and pass it to `downloadPDF(pdfHtml, filename)`. Keep `generateClientPDF(client, mockDetailData)` unchanged and do not modify any other pages."
        }
      ]
    }
  ]
}